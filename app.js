(()=>{"use strict";var e={758:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),s(333);const a=i(s(522));class o{constructor(e,t,s,i,a,o){this.shape=e,this.rotation=t,this.x=s,this.y=i,this.color=a,this.game=o,this.images=[]}init(){for(let e=0;e<4;++e){this.images[e]=[];for(let t=0;t<4;++t)this.images[e][t]=this.game.add.image(e*a.default.blockSize,t*a.default.blockSize,"blocks")}this.setPosition(this.x,this.y),this.setShape(this.shape,this.rotation),this.setColor(this.color)}setColor(e){this.color=-1==e?a.default.emptyBlockIx:e;for(let e=0;e<4;++e)for(let t=0;t<4;++t)this.images[t][e].setFrame(this.color)}setPosition(e,t){this.x=e,this.y=t;const s=this.game.getTileMapOffset();for(let i=0;i<4;++i)for(let o=0;o<4;++o)this.images[o][i].setX((e+o-.5)*a.default.blockSize+s.x),this.images[o][i].setY((a.default.height-(t+i)+1.5)*a.default.blockSize+s.y)}setShape(e,t){if(this.shape=e,this.rotation=t,e<0)for(let e=0;e<4;++e)for(let t=0;t<4;++t)this.images[e][t].setAlpha(0);else for(let e=0;e<4;++e)for(let t=0;t<4;++t){const s=1==o.shapes[this.shape][this.rotation][e][t];this.images[e][t].setAlpha(s?1:0)}}}t.default=o,o.shapes=[[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]],[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]],[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],[[[0,0,0,0],[0,0,1,1],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,1],[0,0,0,1],[0,0,0,0]],[[0,0,0,0],[0,0,1,1],[0,1,1,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,1],[0,0,0,1],[0,0,0,0]]],[[[0,0,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,0]],[[0,0,0,1],[0,0,1,1],[0,0,1,0],[0,0,0,0]],[[0,0,0,0],[0,1,1,0],[0,0,1,1],[0,0,0,0]],[[0,0,0,1],[0,0,1,1],[0,0,1,0],[0,0,0,0]]],[[[0,0,0,0],[0,1,1,1],[0,1,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,1],[0,0,0,0]],[[0,0,0,1],[0,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,1,1,0],[0,0,1,0],[0,0,1,0],[0,0,0,0]]],[[[0,0,0,0],[0,1,1,1],[0,0,0,1],[0,0,0,0]],[[0,0,1,1],[0,0,1,0],[0,0,1,0],[0,0,0,0]],[[0,1,0,0],[0,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,1,1,0],[0,0,0,0]]],[[[0,0,0,0],[0,1,1,1],[0,0,1,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,1],[0,0,1,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,1,1,0],[0,0,1,0],[0,0,0,0]]]]},522:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class s{}t.default=s,s.width=10,s.height=20,s.blockSize=24,s.emptyBlockIx=8,s.borderBlockIx=9},862:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),s(333);const a=i(s(919)),o=i(s(520)),r=i(s(799)),h=i(s(647)),l=i(s(898)),n=i(s(530)),c=i(s(790)),d={width:800,height:600,type:Phaser.AUTO,parent:"content",title:"TS Tetris by Antti AlkkiomÃ¤ki"};class u extends Phaser.Game{constructor(e){l.default.LogSceneMethodEntry("Game","constructor"),super(e),this.scene.add(a.default.Name,a.default),this.scene.add(o.default.Name,o.default),this.scene.add(h.default.Name,h.default),this.scene.add(r.default.Name,r.default),this.scene.add(n.default.Name,n.default),this.scene.add(c.default.Name,c.default),this.scene.start(a.default.Name)}}t.default=u,window.onload=()=>{new u(d)}},919:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(520)),o=i(s(898));class r extends Phaser.Scene{preload(){}create(){o.default.LogSceneMethodEntry("Boot","create"),this.scene.start(a.default.Name)}}t.default=r,r.Name="Boot"},530:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(898)),o=i(s(758)),r=i(s(522));class h extends Phaser.Scene{constructor(){super(...arguments),this.gameArea=[],this.currentBlock=new o.default(-1,0,0,0,0,this),this.nextBlock=[null,null,null],this.nextShape=[0,0,0],this.nextColor=[0,0,0],this.moveUpdateDelay=300,this.fallSpeed=0,this.isGameOver=!0,this.leftTimer=0,this.rightTimer=0,this.score=0,this.previousScore=0,this.highscore=0}create(){a.default.LogSceneMethodEntry("MainGame","create"),this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"background"),this.createTileMap(),this.createTexts(),this.currentBlock.init(),this.initGame(),this.enterKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.ENTER),this.leftKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.LEFT),this.rightKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.RIGHT),this.upKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.UP),this.downKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.DOWN)}createTileMap(){const e=this.getTileMapOffset(),t=this.make.tilemap({width:r.default.width+2,height:r.default.height+1,tileWidth:r.default.blockSize,tileHeight:r.default.blockSize}),s=t.addTilesetImage("blocks",null,r.default.blockSize,r.default.blockSize);this.layer=t.createBlankLayer("layer1",s,e.x,e.y),this.layer.fill(r.default.borderBlockIx,0,0,1,r.default.height),this.layer.fill(r.default.borderBlockIx,r.default.width+1,0,1,r.default.height),this.layer.fill(r.default.borderBlockIx,0,r.default.height,r.default.width+2,1),this.layer.fill(r.default.emptyBlockIx,1,0,r.default.width,r.default.height)}createTexts(){this.highscoreText=this.add.text(600,180,"HI-SCORE\n"+this.highscore,{align:"left"}).setFontFamily("monospace").setFontSize(22).setFill("#fedb4f"),this.scoreText=this.add.text(600,250,"SCORE\n0",{align:"left"}).setFontFamily("monospace").setFontSize(22).setFill("#fff"),this.gameOverText=this.add.text(600,320,"",{align:"left"}).setFontFamily("monospace").setFontSize(22).setFill("#ff1a6b"),this.restartText=this.add.text(400,570,"",{align:"center"}).setOrigin(.5,.5).setFontFamily("monospace").setFontSize(22).setFill("#676767")}getTileMapOffset(){return{x:this.cameras.main.centerX-r.default.width*r.default.blockSize/2-r.default.blockSize,y:this.cameras.main.centerY-(r.default.height+1)*r.default.blockSize/2}}initGame(){this.loadHighscore(),this.gameOverText.setText(""),this.restartText.setText(""),this.currentBlock.setShape(-1,0),this.lastMoveTime=Date.now(),this.isGameOver=!1,this.score=0;for(let e=0;e<3;++e)this.nextShape[e]=a.default.getRandomShape(),this.nextColor[e]=a.default.getRandomColor();this.refreshNextBlocks();for(let e=0;e<r.default.width;++e){this.gameArea[e]=[];for(let t=0;t<r.default.height;++t)this.changeBlock(e,t,-1)}}update(){this.updateInput(),this.isGameOver||(-1==this.currentBlock.shape&&this.createNewBlock(),this.fallSpeed=10+10*Math.floor(this.score/200),Date.now()-this.lastMoveTime>this.moveUpdateDelay&&(this.lastMoveTime=Date.now(),this.tryMoveCurrentBlock()),this.tryRemoveFullRows(),this.previousScore!=this.score&&(this.scoreText.setText("SCORE\n"+this.score),this.previousScore=this.score))}createNewBlock(){this.currentBlock.setShape(this.nextShape[0],0),this.currentBlock.setPosition(r.default.width/2,r.default.height+1),this.currentBlock.setColor(this.nextColor[0]),this.nextShape[0]=this.nextShape[1],this.nextShape[1]=this.nextShape[2],this.nextShape[2]=a.default.getRandomShape(),this.nextColor[0]=this.nextColor[1],this.nextColor[1]=this.nextColor[2],this.nextColor[2]=a.default.getRandomColor(),this.refreshNextBlocks()}refreshNextBlocks(){for(let e=0;e<3;++e)null==this.nextBlock[e]?(this.nextBlock[e]=new o.default(this.nextShape[e],0,13+3*e,r.default.height-3,this.nextColor[e],this),this.nextBlock[e].init()):(this.nextBlock[e].setShape(this.nextShape[e],0),this.nextBlock[e].setColor(this.nextColor[e]))}updateInput(){if(this.isGameOver)return void(Phaser.Input.Keyboard.JustDown(this.enterKey)&&this.initGame());const e=Phaser.Input.Keyboard.JustDown(this.leftKey),t=Phaser.Input.Keyboard.JustDown(this.rightKey),s=Phaser.Input.Keyboard.JustDown(this.upKey);(e||this.leftKey.isDown&&Date.now()-this.leftTimer>120)&&(this.leftTimer=Date.now(),this.isBlockCollide(this.currentBlock.x-1,this.currentBlock.y,this.currentBlock.shape,this.currentBlock.rotation)||this.currentBlock.setPosition(this.currentBlock.x-1,this.currentBlock.y)),(t||this.rightKey.isDown&&Date.now()-this.rightTimer>120)&&(this.rightTimer=Date.now(),this.isBlockCollide(this.currentBlock.x+1,this.currentBlock.y,this.currentBlock.shape,this.currentBlock.rotation)||this.currentBlock.setPosition(this.currentBlock.x+1,this.currentBlock.y)),s&&(this.isBlockCollide(this.currentBlock.x,this.currentBlock.y,this.currentBlock.shape,this.currentBlock.rotation+1)||this.currentBlock.setShape(this.currentBlock.shape,(this.currentBlock.rotation+1)%4)),this.downKey.isDown?this.moveUpdateDelay=50:this.moveUpdateDelay=Math.max(500-this.fallSpeed,50)}tryMoveCurrentBlock(){this.isBlockCollide(this.currentBlock.x,this.currentBlock.y-1,this.currentBlock.shape,this.currentBlock.rotation)?this.handleCollision():this.currentBlock.setPosition(this.currentBlock.x,this.currentBlock.y-1)}handleCollision(){for(let e=-2;e<2;++e)for(let t=-2;t<2;++t)if(0!=o.default.shapes[this.currentBlock.shape][this.currentBlock.rotation][e+2][t+2]){if(this.currentBlock.x+e<0||this.currentBlock.x+e>=r.default.width||this.currentBlock.y+t<0)continue;if(this.currentBlock.y+t>=r.default.height){this.gameOver();continue}this.changeBlock(this.currentBlock.x+e,this.currentBlock.y+t,this.currentBlock.color+4)}this.currentBlock.shape=-1,this.isGameOver||(this.score+=10)}gameOver(){this.isGameOver=!0,this.updateHighscore(),this.gameOverText.setText("GAME OVER"),this.restartText.setText("Press ENTER to restart")}isBlockCollide(e,t,s,i){i>3&&(i=0);for(let a=-2;a<2;++a)for(let h=-2;h<2;++h)if(0!=o.default.shapes[s][i][a+2][h+2]){if(e+a<0||e+a>r.default.width-1||t+h<0)return!0;if(t+h<r.default.height&&-1!=this.gameArea[e+a][t+h])return!0}return!1}tryRemoveFullRows(){let e=0;for(let t=0;t<r.default.height;++t){let s=!0;for(let e=0;e<r.default.width;++e)-1==this.gameArea[e][t]&&(s=!1);if(s){++e;for(let e=t;e<r.default.height;++e)for(let t=0;t<r.default.width;++t)e==r.default.height-1?this.changeBlock(t,e,-1):this.changeBlock(t,e,this.gameArea[t][e+1])}}1==e?this.score+=100:2==e?this.score+=300:3==e?this.score+=600:e>=4&&(this.score+=1e3)}changeBlock(e,t,s){this.gameArea[e][t]=s,-1==s?this.layer.putTileAt(r.default.emptyBlockIx,e+1,r.default.height-t-1):this.layer.putTileAt(s,e+1,r.default.height-t-1)}loadHighscore(){}updateHighscore(){this.highscore<this.score&&(this.highscore=this.score,this.highscoreText.setText("HI-SCORE\n"+this.highscore))}}t.default=h,h.Name="MainGame"},799:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(898)),o=i(s(530)),r=i(s(790));class h extends Phaser.Scene{create(){a.default.LogSceneMethodEntry("MainMenu","create");const e=this.cameras.main.height/3,t=this.add.text(this.cameras.main.centerX,e,"Start");t.setFontFamily("monospace").setFontSize(40).setFill("#fff").setAlign("center").setOrigin(.5),t.setInteractive(),t.on("pointerdown",(()=>{this.scene.start(o.default.Name)}),this);const s=this.add.text(this.cameras.main.centerX,2*e,"Settings");s.setOrigin(.5),s.setFontFamily("monospace").setFontSize(30).setFill("#fff"),s.setInteractive(),s.on("pointerdown",(()=>{this.scene.start(r.default.Name)}),this)}}t.default=h,h.Name="MainMenu"},790:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(898)),o=i(s(799));class r extends Phaser.Scene{create(){a.default.LogSceneMethodEntry("MainSettings","create");const e=this.cameras.main.height/4,t=this.add.text(this.cameras.main.centerX,2*e,"Go Back");t.setOrigin(.5).setFontFamily("monospace").setFontSize(25).setFill("#fff").setInteractive(),t.on("pointerdown",(()=>{this.scene.start(o.default.Name)}),this)}}t.default=r,r.Name="MainSettings"},520:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(647)),o=i(s(898));class r extends Phaser.Scene{preload(){this.load.path="assets/",this.load.image("phaser_pixel_medium_flat"),this.load.image("Phaser-Logo-Small"),this.load.image("background"),this.load.spritesheet("blocks","blocks.png",{frameWidth:24,frameHeight:24})}create(){o.default.LogSceneMethodEntry("Preloader","create"),this.scene.start(a.default.Name)}}t.default=r,r.Name="Preloader"},647:function(e,t,s){var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const a=i(s(898)),o=i(s(530));class r extends Phaser.Scene{preload(){this.load.path="assets/"}create(){a.default.LogSceneMethodEntry("SplashScreen","create"),this.add.text(this.cameras.main.centerX,.5*this.cameras.main.centerY,"TypeScript Tetris\nby\nAntti AlkkiomÃ¤ki",{align:"center"}).setOrigin(.5,0).setFontFamily("monospace").setFontSize(26).setFill("#fff");const e=this.add.text(this.cameras.main.centerX,this.cameras.main.centerY-25,"Powered By");e.setOrigin(.5,.5),e.setFontFamily("monospace").setFontSize(20).setFill("#fff"),this.add.image(this.cameras.main.centerX,this.cameras.main.centerY,"phaser_pixel_medium_flat"),this.input.setDefaultCursor("pointer"),this.input.on("pointerdown",this.startGame,this),this.time.addEvent({delay:5e3,callback:this.startGame,callbackScope:this,loop:!1})}startGame(){this.scene.start(o.default.Name)}}t.default=r,r.Name="SplashScreen"},898:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});class s{static Log(e){console.log((new Date).toISOString()+" : "+e)}static LogSceneMethodEntry(e,t){this.Log("Entered "+e+" "+t+"()")}static getRandom(e,t){return Math.floor(Math.random()*(t-e)+e)}static getRandomShape(){return s.getRandom(0,7)}static getRandomColor(){return s.getRandom(0,4)}}t.default=s},333:e=>{e.exports=Phaser}},t={};!function s(i){var a=t[i];if(void 0!==a)return a.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,s),o.exports}(862)})();
//# sourceMappingURL=app.js.map